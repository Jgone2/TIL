# 1. Singleton Pattern

`Singleton Pattern`ì€ ì¸ìŠ¤í„´ìŠ¤ê°€ 1ê°œë§Œ ìƒì„±ë˜ëŠ” ê²ƒì„ ë³´ì¥í•˜ëŠ” ìë°”ì˜ ë””ìì¸ íŒ¨í„´ ì¤‘ í•˜ë‚˜ë‹¤. ì‹±ê¸€í†¤ íŒ¨í„´ì„ ìœ ì§€í•˜ë ¤ë©´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ 1ê°œ ì´ìƒ ìƒì„±í•˜ì§€ ëª»í•˜ë„ë¡ ë°©ì§€í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— `private`ìƒì„±ìë¥¼ ì‚¬ìš©í•´ì„œ new í‚¤ì›Œë“œì˜ ì‚¬ìš©ì„ ë§‰ì•„ì•¼í•œë‹¤.

**| SingletonExam**

```java
private static final StingletonExam instance = new SingletonService();
// publicìœ¼ë¡œ ì§€ì •í•´ì„œ ì¸ìŠ¤í„´ìŠ¤ê°€ í•„ìš”í•˜ë©´ ì´ ë©”ì„œë“œë¥¼ í†µí•´ì„œë§Œ ì¡°íšŒê°€ëŠ¥í•˜ë„ë¡ í—ˆìš©
public static SingletonService getInstance() {
	return instance;
}
// ìƒì„±ì privateë¥¼ ì‚¬ìš©í•˜ì—¬ ì™¸ë¶€ì—ì„œ new í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•´ì„œ ê°ì²´ ìƒì„± ë¶ˆê°€
private SingletonService(){}
```

ìœ„ì˜ ì½”ë“œë¥¼ ë³´ë©´ privateìƒì„±ìë¡œ SingletonServiceì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ê³  ìƒì„±ì ë˜í•œ privateìƒì„±ìë¥¼ ì‚¬ìš©í•´ì„œ êµ¬í˜„í•¨ìœ¼ë¡œì¨ ì™¸ë¶€ì—ì„œ SingletonExamì„ ìƒì„±í•´ì„œ ì°¸ì¡°í•˜ì§€ ëª»í•˜ë„ë¡ ì„¤ê³„ë˜ì–´ ìˆë‹¤.

SingletonServiceë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ì´ë¯¸ SIngletonExamí´ë˜ìŠ¤ì—ì„œ ìƒì„±ëœ ìƒì„±ìë¥¼ `getInstance()`ë¡œ ì°¸ì¡°í•´ì„œ ì‚¬ìš©ì„ í•´ì•¼í•œë‹¤.

ìœ„ì™€ ê°™ì´ ì‹±ê¸€í†¤ íŒ¨í„´ì„ ì‚¬ìš©í•˜ë©´ ì—¬ëŸ¬ ì‚¬ìš©ìê°€ ìš”ì²­ì„ í•˜ë©´ ìš”ì²­ë°›ì€ ìˆ˜ ë§í¼ ì¸ìŠ¤í„´ìŠ¤í™” í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ ì´ë¯¸ ìƒì„±ëœ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¸ì¡°í•˜ê²Œ ë§Œë“ ë‹¤.

ê·¸ëŸ¬ë‚˜ ìœ„ì˜ ì‹±ê¸€í†¤ íŒ¨í„´ì—ë„ ì—¬ëŸ¬ê°€ì§€ ë¬¸ì œì ì´ ì¡´ì¬í•˜ëŠ”ë° ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œì ì´ ì¡´ì¬í•œë‹¤.

## 1. ë¬¸ì œì 

- ì‹±ê¸€í†¤ íŒ¨í„´ êµ¬í˜„ì„ ìœ„í•œ ì½”ë“œë¥¼ ë”°ë¡œ ì‘ì„±í•´ì•¼í•¨.(êµ¬í˜„ ì½”ë“œ ìì²´ê°€ ê¸¸ë‹¤)
- ì˜ì¡´ê´€ê³„ ìƒ í´ë¼ì´ì–¸íŠ¸ê°€ êµ¬í˜„ì²´ í´ë˜ìŠ¤ì— ì˜ì¡´(class.getInstance()) â†’ DIPìœ„ë°˜
- í´ë¼ì´ì–¸íŠ¸ê°€ êµ¬í˜„ì²´ í´ë˜ìŠ¤ì— ì˜ì¡´í•´ì„œ OCPì›ì¹™ ìœ„ë°˜ ê°€ëŠ¥ì„± â­•ï¸
- í…ŒìŠ¤íŠ¸ì˜ ì–´ë ¤ì›€(ì¸ìŠ¤í„´ìŠ¤ê°€ ì´ë¯¸ ìƒì„±ë˜ì–´ ì„¤ì •ì´ ë˜ì–´ ìˆìŒ)
- ë‚´ë¶€ ì†ì„±ì„ ë³€ê²½í•˜ê±°ë‚˜ ì´ˆê¸°í™” ì–´ë ¤ì›€
- private ìƒì„±ìë¡œ ìì‹ í´ë˜ìŠ¤ ìƒì„± ì–´ë ¤ì›€
- ë¡œì§ì˜ ìœ ì—°ì„± â†“

ìë°”ì—ì„œ ì‹±ê¸€í†¤ íŒ¨í„´ì€ ìœ„ì™€ ê°™ì€ ë¬¸ì œì ë“¤ì„ ì§€ë‹ˆê³  ìˆë‹¤. í•˜ì§€ë§Œ ìŠ¤í”„ë§ì—ì„œëŠ” ì´ëŸ° ì‹±ê¸€í†¤ íŒ¨í„´ì˜ ë¬¸ì œì ë“¤ì„ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

# 2. ì‹±ê¸€í†¤ ì»¨í…Œì´ë„ˆ(Singleton Container)

ìŠ¤í”„ë§ì—ì„œ ì‹±ê¸€í†¤ ì»¨í…Œì´ë„ˆë¥¼ ì‚¬ìš©í•˜ë©´ ì‹±ê¸€í†¤ íŒ¨í„´ì˜ ë¬¸ì œì ì„ í•´ê²°í•˜ê³ , ì‹±ê¸€í†¤ íŒ¨í„´ì˜ ì¥ì ì¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì˜¤ì§ 1ê°œë¡œ ìœ ì§€ì‹œì¼œ ì¤„ ìˆ˜ ìˆë‹¤.

ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì—ì„œëŠ” ì• ë„ˆí…Œì´ì…˜í•˜ë‚˜ë¡œ `ìë™ìœ¼ë¡œ ì‹±ê¸€í†¤ìœ¼ë¡œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê´€ë¦¬`í•´ì¤€ë‹¤. ë˜í•œ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ì‹±ê¸€í†¤ ì»¨í…Œì´ë„ˆì—­í• ì„ ìˆ˜í–‰í•˜ë©° ì´ëŸ° ê¸°ëŠ¥(ì‹±ê¸€í†¤ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ë° ê´€ë¦¬)ì„ `ì‹±ê¸€í†¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬`ë¼ê³  í•œë‹¤. ì´ë ‡ê²Œ ìŠ¤í”„ë§ì—ì„œ `ìë™ìœ¼ë¡œ ì‹±ê¸€í†¤ íŒ¨í„´ì„ ìœ ì§€`ì‹œì¼œì£¼ê¸° ë•Œë¬¸ì— ì‹±ê¸€í†¤ íŒ¨í„´ì˜ ë‹¨ì ë“¤(ì›ì¹™ ìœ„ë°˜ ê°€ëŠ¥ì„±, ë‚®ì€ ìœ ì—°ì„± ë“±)ì„ ì§€ìš°ê³  ì¥ì ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ëë‹¤.

ì‹±ê¸€í†¤ ë°©ì‹ì€ í•˜ë‚˜ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê³µìœ í•˜ê¸° ë•Œë¬¸ì— ë¬´ìƒíƒœ(stateless)ë¡œ ì„¤ê³„í•´ì•¼í•œë‹¤. íŠ¹ì • í´ë¼ì´ì–¸íŠ¸ì— ì˜ì¡´ì ì¸ í•„ë“œê°€ ìˆìœ¼ë©´ ì•ˆë˜ë©°, ê°’ì„ ë³€ê²½í•  ìˆ˜ ìˆëŠ” í•„ë“œë„ ë§ˆì°¬ê°€ì§€ë¡œ ì¡´ì¬í•˜ë©´ ì•ˆëœë‹¤. ê°€ê¸‰ì  `read-only`ë°©ì‹ìœ¼ë¡œë§Œ ì§€ì›ë˜ì–´ì•¼ í•˜ë©° í•„ë“œê°€ ì•„ë‹Œ ê³µìœ ë˜ì§€ ì•ŠëŠ” ì§€ì—­ë³€ìˆ˜, íŒŒë¼ë¯¸í„°, ThreadLocal ë“±ì„ ì‚¬ìš©í•´ì•¼í•œë‹¤.

> ğŸ’¡**ThreadLocal**
> ì°¾ì•„ë³´ê³  ì ì–´ë³´ì

ë§Œì•½ ìŠ¤í”„ë§ ë¹ˆì˜ í•„ë“œì— ê³µìœ  ê°’ì„ ì„¤ì •í•˜ê²Œ ë˜ë©´ ë™ì‹œ ì°¸ì¡°ê°€ ë˜ê³  ìˆì„ ë•Œ ê°’ì„ ìˆ˜ì •í•˜ê³  ì €ì¥í–ˆì„ ë•Œ ëŠ¦ê²Œ ì €ì¥ëœ ê°’ìœ¼ë¡œ ë°”ë¡œ ë®ì–´ì ¸ í° ì¥ì• ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

```java
public static class TestConfig {
	@Bean
	public ... Service() {
		return new Service();
	}
}
```

ë§Œì•½ ìœ„ì™€ ê°™ì´ beanì´ ë“±ë¡ë˜ì–´ ìˆì„ ë•Œ ì‹±ê¸€í†¤ íŒ¨í„´ì„ ì‚¬ìš©í•´ì„œ ê°’ì„ ìˆ˜ì •í•˜ëŠ” Testì½”ë“œë¥¼ ì‘ì„±í•´ë³´ì•˜ë‹¤.

```java
@Test
void test() {
	ApplicationContext ac = new AnnotationConfigApplicationContext(TestConfig.class);
    Service service1 = ac.getBean(Service.class);
    Service service2 = ac.getBean(Service.class);

	int userKim = service1.order("Kim", 1000);
    int userLee = service2.order("Lee", 2000);
    assertEquals(userKim, 2000);
}
```

ìœ„ì˜ ì½”ë“œì—ì„œ order()ì—ì„œ priceê°’ì´ returnì´ ëœë‹¤ê³  ê°€ì •í–ˆì„ ë•Œ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ë©´ ì •ìƒì ìœ¼ë¡œ testê°€ ìˆ˜í–‰ë  ê²ƒì´ë‹¤. ì™œëƒí•˜ë©´ ì‹±ê¸€í†¤ìœ¼ë¡œ ìœ ì§€ ë˜ê³  ìˆê¸° ë•Œë¬¸ì— priceê°’ì´ 2000ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆê¸° ë•Œë¬¸ì´ë‹¤.

ê·¸ëŸ¬ê¸° ë•Œë¬¸ì— ì‹±ê¸€í†¤ ë°©ì‹ì„ ì‚¬ìš©í•  ë•ŒëŠ” ì£¼ì˜ë¥¼ ê¸°ìš¸ì—¬ ì‚¬ìš©í•´ì•¼í•œë‹¤.

> ğŸ’¡ **ì‹±ê¸€í†¤ ë°©ì‹ì˜ ì£¼ì˜ì **

- íŠ¹ì • í´ë¼ì´ì–¸íŠ¸ê°€ ê°’ì„ ë³€ê²½/ì„¤ì •í•  ìˆ˜ ìˆìœ¼ë©´ ì•ˆëœë‹¤.
- read-onlyë°©ì‹ì´ì–´ì•¼í•œë‹¤.
- ìŠ¤í”„ë§ ë¹ˆì˜ ê³µìœ  ê°’ì„ ì„¤ì •í•˜ë©´ ì¥ì• ê°€ ë°œìƒí•œë‹¤.

# 3. @Configuration

```java
@Configuration
public class AppConfig {
		@Bean
        public MemberService memberService() {
            return new MemberServiceImpl(memberRepository());
        }
		@Bean
        public OrderService orderService() {
            return new OrderServiceImpl(memberRepository(), discountPolicy());
        }
		@Bean
        public MemberRepository memberRepository() {
            return new MemoryMemberRepository();
        }
		@Bean
        public DiscountPolicy discountPolicy() {
            return new FixDiscountPolicy();
        }
}
```

ìë°”ì½”ë“œì—ì„œ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë¥¼ ì‚¬ìš©í•œ ì½”ë“œë¥¼ ë³€í™˜í–ˆì„ ë•Œ ì‚¬ìš©í–ˆë–¤ AppConfigì˜ˆì œë‹¤. ìœ„ì˜ ì½”ë“œë¥¼ ë³´ë©´ `new MemoryMemberRespository()`ëŠ” `memberService()`ê°€ í˜¸ì¶œë  ë•Œ,`orderService()`ê°€ í˜¸ì¶œë  ë•Œ ì´ë ‡ê²Œ ë‘ë²ˆ í˜¸ì¶œë˜ì–´ì•¼ í•œë‹¤.

```java
public MemberRepository getMemberRepo() {
	return memberRepository;
}
```

ê·¸ëŸ¬ë‚˜ `memberRespository`ë¥¼ í˜¸ì¶œí•˜ëŠ” ë‘ ë©”ì„œë“œì— ì•„ë˜ ì½”ë“œë¥¼ ì‚½ì…í•˜ê³  ë‹¤ìŒê³¼ ê°™ì€ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ì‘ì„±í•˜ë©´ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ê°€ ì •ìƒì ìœ¼ë¡œ ì¢…ë£Œëœë‹¤.

```java
ApplicationContext ac = new
  AnnotationConfigApplicationContext(AppConfig.class);
          MemberServiceImpl memberService = ac.getBean("memberService",
  MemberServiceImpl.class);
          OrderServiceImpl orderService = ac.getBean("orderService",
  OrderServiceImpl.class);
assertThat(memberService.getMemberRepo()).isSameAs(orderService.getMemberRepo());
```

ìœ„ì™€ ê°™ì€ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  ë¡œê·¸ë¥¼ ë§Œì•½ì— ì‘ì„±í•´ì„œ ë¡œê·¸ë¥¼ ë³´ë©´ memberRepository ì¸ìŠ¤í„´ìŠ¤ëŠ” í•˜ë‚˜ë¡œ ê³µìœ ë˜ì–´ ì‚¬ìš©ë˜ê³  ìˆìŒì„ ì•Œ ìˆ˜ ìˆì„ ê²ƒì´ë‹¤. ì¦‰, `new MemoryMemberRepository`ê°€ í•œë²ˆë§Œ ìˆ˜í–‰ëœë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤. ì–´ë–»ê²Œ @Configurationê³¼ @Beanë§Œ ì¶”ê°€í–ˆì„ ë¿ì¸ë° ì‹±ê¸€í†¤ì„ ìœ ì§€ì‹œì¼œ ì¤„ ìˆ˜ ìˆì„ê¹Œ?

## 1. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ì‹±ê¸€í†¤ì„ ìë™ìœ¼ë¡œ ìœ ì§€ì‹œì¼œ ì¤„ ìˆ˜ ìˆëŠ” ì´ìœ  - ë°”ì´íŠ¸ ì½”ë“œ ì¡°ì‘(feat.@Configuration)

ìœ„ì˜ ì˜ˆì œì—ì„œ ì•„ë˜ assertThatêµ¬ë¬¸ì„ ì‹¤í–‰ì‚¬ë©´ getMemberRepo()ë¥¼ ì‹¤í–‰í•˜ë©´ `new MemoryMemberRepository`ê°€ ì‹±ê¸€í†¤ìœ¼ë¡œ ìœ ì§€ ë˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

```java
assertThat(memberService.getMemberRepository()).isSameAs(orderService.getMemberRepository());
```

ì´ê²ƒì´ ê°€ëŠ¥í•œ ì´ìœ ëŠ” ìŠ¤í”„ë§ì—ì„œ í´ë˜ìŠ¤ì˜ ë°”ì´íŠ¸ì½”ë“œë¥¼ ì¡°ì‘í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì¸ë°, ì´ ë°”ì´íŠ¸ ì½”ë“œëŠ” `@Configuration`ë¥¼ ì ìš©í•œ êµ¬ì„±í´ë˜ìŠ¤ì—ì„œ ì‚¬ìš©ëœë‹¤.

### 1. ë°”ì´íŠ¸ ì½”ë“œ ì¡°ì‘

`@Configuration`ë¥¼ ì ìš©í•œ `Config`íŒŒì¼ì—ì„œ í´ë˜ìŠ¤ì˜ ì •ë³´ë¥¼ ì¶œë ¥í•´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì¶œë ¥ëœë‹¤.

**| ConfigurationSingletonTest**

```java
@Test
void configurationClassTest() {
    ApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class);
    AppConfig bean = ac.getBean(AppConfig.class);

    System.out.println("bean = " + bean.getClass());
}
```

**| ì¶œë ¥ ê°’**

```java
bean = class com.example.hellospring.AppConfig$$EnhancerBySpringCGLIB$$397d666
```

**| ìˆœìˆ˜ í´ë˜ìŠ¤ ì •ë³´ ì¶œë ¥**

```text/plain
bean = class com.example.hellospring.AppConfig
```

ì›ë˜ ìˆœìˆ˜ í´ë˜ìŠ¤ì˜ ì •ë³´ë¥¼ ê°€ì ¸ ì˜¤ë©´ `ìˆœìˆ˜ í´ë˜ìŠ¤ ì •ë³´ ì¶œë ¥`ê³¼ ê°™ì´ ì¶œë ¥ë˜ê² ì§€ë§Œ í´ë˜ìŠ¤ëª…ì— `CGLIB$$*`ê°€ ì¶”ê°€ë˜ì–´ ì¶œë ¥ëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

ì´ê²ƒì€ ìŠ¤í”„ë§ì´ `CGLIB`ë¼ëŠ” ë°”ì´íŠ¸ì½”ë“œ ì¡°ì‘ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•´ì„œ `Config`í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ì€ ì„ì˜ì˜ ë‹¤ë¥¸ í´ë˜ìŠ¤ë¥¼ ìƒì„±í•˜ê³ , ì´ í´ë˜ìŠ¤ë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•œ ê²ƒì´ë‹¤.

ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì—ëŠ” `Config@CGLIB$$*`í´ë˜ìŠ¤ê°€ ë“±ë¡ì´ ë˜ì–´ ì‚¬ìš©ë˜ê² ì§€ë§Œ, `Config`ë¥¼ ìƒì†ë°›ì€ í´ë˜ìŠ¤ì´ê¸° ë•Œë¬¸ì— ìš°ë¦¬ê°€ ì§ì ‘ ìƒì„±í•œ `Config`íƒ€ì…ìœ¼ë¡œ ë˜‘ê°™ì´ ì¡°íšŒë¥¼ í•  ìˆ˜ ìˆë‹¤.

ì´ê²ƒì„ ì‚¬ìš©í•´ì„œ ìŠ¤í”„ë§ì—ì„œ ì‹±ê¸€í†¤ì˜ ì¥ì ë§Œì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ êµ¬ì„±ì •ë³´ì— í•­ìƒ `@Configuration`ì• ë„ˆí…Œì´ì…˜ì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

# ğŸ“š Reference

- [Infrean - ê¹€ì˜í•œë‹˜ ìŠ¤í”„ë§ ë¡œë“œë§µ](https://www.inflearn.com/roadmaps/373)
- [ì½”ë“œìŠ¤í…Œì´ì¸  ë°±ì—”ë“œ ë¶€íŠ¸ìº í”„](https://www.codestates.com/course/backend-engineering)
